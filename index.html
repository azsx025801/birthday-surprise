<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>小廖生日驚喜大挑戰🎉</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ✅ 在這裡插入 Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            text-align: center;
            background-color: #fffbe6; /* 柔和黃色背景 */
            margin: 0;
            padding: 20px;
            color: #4b0082; /* 深紫色字體 */
        }
        h2 {
            color: #6a0dad; /* 紫色標題 */
            font-size: 2.2rem;
        }
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #ffde59, #f4a900); /* 黃色系漸變 */
            color: #fff;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        }
        button:hover {
            background: linear-gradient(135deg, #f4a900, #ffde59);
        }
        .hidden { display: none; }
        
        #wheel3D {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }

        #welcome p {
            font-size: 1.2rem;
            color: #4b0082;
        }

        #wheel h3 {
            color: #6a0dad;
            font-size: 1.5rem;
        }

        #result {
            margin-top: 15px;
            font-size: 1.3rem;
            font-weight: bold;
            color: #8b5cf6; /* 柔和紫色 */
        }
    </style>
</head>

<body>
    <h2>🎉 小廖生日快樂 🎂</h2>
    <div id="welcome">
        <p>準備好迎接專屬妳的生日驚喜嗎？</p>
        <button onclick="startQuiz()">👉 點我開始驚喜之旅！</button>
    </div>
    <div id="quiz" class="hidden"></div>
    <div id="wheel" class="hidden">
        <h3>🎡 旋轉球體抽獎 🎡</h3>
        <div id="wheel3D"></div>
        <button id="spinButton" onclick="spinWheel()">🎡 點擊旋轉 (<span id="spinsLeft">0</span> 次機會)</button>
        <div id="result"></div>
    </div>
<script>

document.addEventListener("DOMContentLoaded", function () {
    let correctAnswers = 0; // 記錄答對的題數
    let spinsLeft = 0; // 抽獎次數

    const quizContainer = document.getElementById("quiz");
    const spinDisplay = document.getElementById("spinsLeft");

    const questions = [
        { q: '我們在一起到2025/3/21總共幾天了？', opts: shuffle(['1638天', '1720天', '1650天', '2000天']), ans: '1638天' },
        { q: '2020/3/21我們在做什麼？', opts: shuffle(['吃燒肉童話','爬台北象山','陽明山看夜景','奎前女友家玩桌遊吃蛋糕']), allCorrect: true },
        { q: '2021/3/21我們在做什麼？', opts: shuffle(['桃園X水族館吵架','日月潭度假','阿里山看日出','射飛鏢去台東']), ans: '桃園X水族館吵架' },
        { q: '2022/3/21我們在做什麼？', opts: shuffle(['日月潭度假','阿里山看日出','桃園X水族館吵架','射飛鏢去台東']), ans: '日月潭度假' },
        { q: '2023/3/21我們在做什麼？', opts: shuffle(['射飛鏢去台東','桃園X水族館吵架','日月潭度假','阿里山看日出']), ans: '射飛鏢去台東' }
    ];

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    function startQuiz() {
        document.getElementById("welcome").style.display = "none";
        quizContainer.style.display = "block";
        showQuestion(0);
    }

    function showQuestion(index) {
        if (index >= questions.length) {
            endQuiz();
            return;
        }

        const question = questions[index];
        let quizHTML = `<p>${question.q}</p>`;
        
        question.opts.forEach(opt => {
            quizHTML += `<button class="quiz-option" data-answer="${opt}">${opt}</button><br>`;
        });

        quizContainer.innerHTML = quizHTML;

        document.querySelectorAll(".quiz-option").forEach(button => {
            button.addEventListener("click", function () {
                checkAnswer(index, this.getAttribute("data-answer"));
            });
        });
    }

    function checkAnswer(index, answer) {
        let message = "";
        if (questions[index].allCorrect === true || answer === questions[index].ans) {
            message = "🎉 小廖答對了！好聰明好棒棒！🥳";
            correctAnswers++;
        } else {
            message = "❌ 答錯了！北七😂";
        }

        alert(message);
        showQuestion(index + 1);
    }

    function endQuiz() {
        quizContainer.style.display = "none";
        document.getElementById("wheel").style.display = "block";
        
        spinsLeft = correctAnswers;
        spinDisplay.innerText = spinsLeft;
        console.log(`✅ 問答結束！累積 ${spinsLeft} 次抽獎機會`);

        // **這裡開始 3D 抽獎球**
        start3DWheel();
    }

    window.startQuiz = startQuiz;
});

// ✅ 3D 抽獎球（移除重複載入 Three.js）
function start3DWheel() {
    console.log("初始化 3D 文字球...");
    const container = document.getElementById("wheel3D");
    if (!container) {
        console.error("❌ 無法找到 #wheel3D，確保 HTML 已顯示該元素");
        return;
    }
    container.innerHTML = ""; // 清空容器，避免重複載入
    
    // **設置滿版大小**
    container.style.position = "fixed";
    container.style.top = "0";
    container.style.left = "0";
    container.style.width = "100vw";
    container.style.height = "100vh";
    container.style.zIndex = "10";
    
    // **初始化 Three.js 場景**
    let scene = new THREE.Scene();
    let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    let renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);
    
    // **添加燈光**
    const light = new THREE.PointLight(0xffffff, 1, 100);
    light.position.set(10, 10, 20);
    scene.add(light);
    
    // **建立球體 (加到更大)**
    const geometry = new THREE.SphereGeometry(15, 64, 64); // 大球體尺寸
    const material = new THREE.MeshStandardMaterial({ color: 0x4b0082, wireframe: true });
    let sphere = new THREE.Mesh(geometry, material);
    scene.add(sphere);
    
    // **獎品名稱**
    const giftItems = [
    "Chanel 香水", "YSL 口紅", "Prada 包包", "Dior 化妝品", "蘋果耳機",
    "高級下午茶", "馬殺雞", "頂級紅酒", "浪漫旅遊", "專屬攝影師",
    "LV 錢包", "Gucci 手錶", "迪士尼樂園票", "高端 SPA", "星巴克隨行杯",
    "現金 5000 元", "現金 10000 元", "現金 20000 元", "日本來回機票", "歐洲夢幻之旅",
    "馬爾地夫雙人行", "韓國購物之旅", "豪華郵輪假期", "頭等艙機票", "超跑體驗",
    "百貨公司禮券", "Apple Watch", "Switch OLED", "PS5 遊戲機", "高級紅酒品酒課",
    "私人管家服務", "五星級酒店住宿", "個人化訂製香水", "環球影城 VIP 票", "國際高級自助餐",
    "豪華露營體驗", "專業攝影寫真", "Helicopter 城市夜景遊覽", "高級餐廳主廚私房菜",
    "頂級瑜珈課程", "滑雪度假村雙人行", "高級皮革定制包", "一日豪車體驗",
    "東京迪士尼全套行程", "高端 AI 智慧家居設備", "私人健身教練 1 個月",
    "米其林三星晚宴", "高端 SPA 年度會員", "環遊世界機票", "夢幻私人島嶼假期"
];
shuffle(giftItems);
    
    // **添加 3D 文字 (改用 CanvasTexture 繪製中文字)**
    const textGroup = new THREE.Group();
giftItems.forEach((gift, index) => {
    const textMaterial = new THREE.MeshBasicMaterial({ 
        map: createTextTexture(gift), 
        transparent: true, 
        side: THREE.DoubleSide,  // **讓文字雙面可見**
        depthTest: false  // **避免被球體遮擋**
    });
    
    const textGeometry = new THREE.PlaneGeometry(7, 2.5); // **適當縮小文字尺寸，讓更多獎品顯示**
    const textMesh = new THREE.Mesh(textGeometry, textMaterial);

    // **隨機分布在整個球體表面，但距離球體更近**
    const theta = Math.acos(2 * Math.random() - 1); // 緯度角度（-90 到 90 度）
    const phi = Math.random() * Math.PI * 2; // 經度角度（0 到 360 度）
    const radius = 20; // **縮小半徑，讓文字更靠近球體，提升密集度**

    textMesh.position.set(
        radius * Math.sin(theta) * Math.cos(phi),
        radius * Math.sin(theta) * Math.sin(phi),
        radius * Math.cos(theta)
    );
    
    textMesh.lookAt(new THREE.Vector3(0, 0, 0)); // **確保文字朝向球體中心**
    textMesh.rotation.y += Math.PI; // **翻轉文字，避免反向**
    textGroup.add(textMesh);
});


    scene.add(textGroup);
    
    camera.position.z = 40; // 調整相機距離，確保整個畫面滿版
    
    // **動畫：球體 & 文字旋轉**
    function animate() {
        requestAnimationFrame(animate);
        sphere.rotation.y += 0.005; // 減慢旋轉速度，使視覺更順暢
        textGroup.rotation.y += 0.005; 
        renderer.render(scene, camera);
    }
    animate();
    
    // **確保視窗大小變化時，畫面適應**
    window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
}

// **繪製中文字貼圖**
function createTextTexture(text) {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 1024; // 提高解析度
    canvas.height = 256;

    ctx.clearRect(0, 0, canvas.width, canvas.height); // 確保背景透明
    ctx.fillStyle = "black"; // **黑色文字，確保高對比**
    ctx.strokeStyle = "white"; // **白色描邊，提高可讀性**
    ctx.lineWidth = 8;

    ctx.font = "bold 140px 微軟正黑體, Arial"; // **加大字體，確保可讀**
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    // **先描邊，然後填充文字**
    ctx.strokeText(text, canvas.width / 2, canvas.height / 2);
    ctx.fillText(text, canvas.width / 2, canvas.height / 2);

    return new THREE.CanvasTexture(canvas);
}

// **確保 shuffle 可用**
function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}

window.start3DWheel = start3DWheel;

</script>
</body>
</html>
