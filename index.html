<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>å°å»–ç”Ÿæ—¥é©šå–œå¤§æŒ‘æˆ°ğŸ‰</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            text-align: center;
            background-color: #fff;
            margin: 0;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            background: #6a0dad;
            color: #fff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }
        .hidden { display: none; }
        canvas { margin-top: 20px; }
        #wheelContainer {
            position: relative;
            display: inline-block;
        }
        #wheelCanvas {
            border: 2px solid black;
            background: white;
            border-radius: 50%;
        }
        #arrow {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 50px;
            background: red;
        }
        #scratchCanvas {
            background: gray;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>ğŸ‰å°å»–ç”Ÿæ—¥å¿«æ¨‚ğŸ‚</h2>
    <div id="welcome">
        <p>æº–å‚™å¥½è¿æ¥å°ˆå±¬å¦³çš„ç”Ÿæ—¥é©šå–œå—ï¼Ÿ</p>
        <button onclick="startQuiz()">ğŸ‘‰ é»æˆ‘é–‹å§‹é©šå–œä¹‹æ—…ï¼</button>
    </div>
    <div id="quiz" class="hidden"></div>
    <div id="wheel" class="hidden">
        <div id="wheelContainer">
            <div id="arrow"></div>
            <canvas id="wheelCanvas" width="300" height="300"></canvas>
        </div>
        <button id="spinButton" onclick="spinWheel()">ğŸ¡ é»æ“Šè½‰ç›¤æŠ½ç (<span id="spinsLeft">0</span> æ¬¡æ©Ÿæœƒ)</button>
        <div id="result"></div>
    </div>
    <div id="scratch" class="hidden">
        <p>ç”¨æ»‘é¼ æˆ–æ‰‹æŒ‡åˆ®é–‹é©šå–œï¼</p>
        <canvas id="scratchCanvas" width="300" height="150"></canvas>
    </div>
    <div id="gift" class="hidden">
        <h2>ğŸçœŸæ­£çš„ç¦®ç‰©æ­æ›‰ï¼</h2>
        <p>ä¸€å°é«˜ç´šç­†é›»ğŸ’» + é«˜ç´šæ»‘é¼ ğŸ–±ï¸</p>
        <p>ä½ æ°¸é æ˜¯æˆ‘çš„é ­çï¼Œæˆ‘æ°¸é æ„›ä½ â¤ï¸</p>
    </div>
<script>
let correctAnswers = 0;
let spinsLeft = 0;
let spinCount = 0;
let hasWonSpecialPrize = false;
const prizes = ["10è¬å…ƒç¾é‡‘", "6è¬å…ƒç¾é‡‘", "æ­æ´²åå¤©é›™äººé£›æ©Ÿ", "ç¥ç§˜ç‰¹åˆ¥ç", "è¬è¬æƒ é¡§"];

const questions = [
    { q: 'æˆ‘å€‘åœ¨ä¸€èµ·åˆ°2025/3/21ç¸½å…±å¹¾å¤©äº†ï¼Ÿ', opts: shuffle(['1638å¤©', '1720å¤©', '1650å¤©', '2000å¤©']), ans: '1638å¤©' },
    { q: '2020/3/21æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ', opts: shuffle(['åƒç‡’è‚‰ç«¥è©±','çˆ¬å°åŒ—è±¡å±±','é™½æ˜å±±çœ‹å¤œæ™¯','å¥å‰å¥³å‹å®¶ç©æ¡ŒéŠåƒè›‹ç³•']), allCorrect: true },
    { q: '2021/3/21æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ', opts: shuffle(['æ¡ƒåœ’Xæ°´æ—é¤¨åµæ¶','æ—¥æœˆæ½­åº¦å‡','é˜¿é‡Œå±±çœ‹æ—¥å‡º','å°„é£›é¢å»å°æ±']), ans: 'æ¡ƒåœ’Xæ°´æ—é¤¨åµæ¶' },
    { q: '2022/3/21æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ', opts: shuffle(['æ—¥æœˆæ½­åº¦å‡','é˜¿é‡Œå±±çœ‹æ—¥å‡º','æ¡ƒåœ’Xæ°´æ—é¤¨åµæ¶','å°„é£›é¢å»å°æ±']), ans: 'æ—¥æœˆæ½­åº¦å‡' },
    { q: '2023/3/21æˆ‘å€‘åœ¨åšä»€éº¼ï¼Ÿ', opts: shuffle(['å°„é£›é¢å»å°æ±','æ¡ƒåœ’Xæ°´æ—é¤¨åµæ¶','æ—¥æœˆæ½­åº¦å‡','é˜¿é‡Œå±±çœ‹æ—¥å‡º']), ans: 'å°„é£›é¢å»å°æ±' }
];

function shuffle(array) {
    return array.sort(() => Math.random() - 0.5);
}

function startQuiz() {
    document.getElementById("welcome").style.display = "none";
    document.getElementById("quiz").style.display = "block";
    showQuestion(0);
}

function showQuestion(index) {
    if (index >= questions.length) {
        document.getElementById("quiz").style.display = "none";
        document.getElementById("wheel").style.display = "block";
        spinsLeft = correctAnswers;
        document.getElementById("spinsLeft").innerText = spinsLeft;
        drawWheel();
        return;
    }
    const question = questions[index];
    let quizHTML = `<p>${question.q}</p>`;
    question.opts.forEach(opt => {
        quizHTML += `<button onclick="checkAnswer(${index}, '${opt}')">${opt}</button><br>`;
    });
    document.getElementById("quiz").innerHTML = quizHTML;
}

function checkAnswer(index, answer) {
    if (questions[index].allCorrect === true || answer === questions[index].ans) {
        alert("å°å»–ç­”å°äº†ï¼å¥½è°æ˜å¥½æ£’æ£’ï¼ğŸ¥³");
        correctAnswers++;
    } else {
        alert("ç­”éŒ¯äº†ï¼åŒ—ä¸ƒğŸ˜‚");
    }
    showQuestion(index + 1);
}

function drawWheel() {
    let wheel = document.getElementById("wheelCanvas");
    let ctx = wheel.getContext("2d");
    let centerX = wheel.width / 2;
    let centerY = wheel.height / 2;
    let radius = wheel.width / 2;
    let startAngle = 0;
    let sliceAngle = (2 * Math.PI) / prizes.length;
    const colors = ["#FFD700", "#FF4500", "#008080", "#4682B4", "#DA70D6"];

    ctx.clearRect(0, 0, wheel.width, wheel.height);
    for (let i = 0; i < prizes.length; i++) {
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
        ctx.fillStyle = colors[i % colors.length];
        ctx.fill();
        ctx.stroke();
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(startAngle + sliceAngle / 2);
        ctx.fillStyle = "black";
        ctx.font = "bold 16px Microsoft JhengHei";
        ctx.fillText(prizes[i], radius - 90, 5);
        ctx.restore();
        startAngle += sliceAngle;
    }
}

function spinWheel() {
    if (spinsLeft > 0) {
        spinsLeft--;
        spinCount++;
        document.getElementById("spinsLeft").innerText = spinsLeft;
        let wheel = document.getElementById("wheelCanvas");
        let degrees;
        let sliceAngle = 360 / prizes.length;
        let currentRotation = wheel.style.transform.match(/-?\d+/g);
        let previousDegrees = currentRotation ? parseInt(currentRotation[0]) : 0;
        let targetIndex;

        if (spinsLeft === 0) {
            targetIndex = prizes.indexOf("ç¥ç§˜ç‰¹åˆ¥ç");
            hasWonSpecialPrize = true;
        } else {
            targetIndex = prizes.indexOf("è¬è¬æƒ é¡§");
        }

        degrees = previousDegrees + (360 * 5) + (360 - ((targetIndex + 0.5) * sliceAngle));
        
        wheel.style.transition = "transform 2s ease-out";
        wheel.style.transform = `rotate(${degrees}deg)`;

        setTimeout(() => {
            let resultText = prizes[targetIndex];
            document.getElementById("result").innerText = `æ­å–œç²å¾— ${resultText} ğŸ`;
            drawWheel(); // é‡æ–°ç¹ªè£½è½‰ç›¤ï¼Œç¢ºä¿ç•«å¸ƒä¸Šçš„çé …èˆ‡æŒ‡é‡å°æ‡‰

            if (spinsLeft === 0) {
                document.getElementById("spinButton").style.display = "none";
                let nextButton = document.createElement("button");
                nextButton.innerText = "å‰å¾€åˆ®åˆ®æ¨‚ ğŸ‰";
                nextButton.onclick = function() {
                    document.getElementById("wheel").style.display = "none";
                    document.getElementById("scratch").style.display = "block";
                    setupScratchCard();
                };
                document.getElementById("wheel").appendChild(nextButton);
            }
        }, 2100);
    }
}

function setupScratchCard() {
    const scratchCanvas = document.getElementById("scratchCanvas");
    const ctx = scratchCanvas.getContext("2d");
    ctx.fillStyle = "gray";
    ctx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);
    
    let isScratched = false;

    function scratch(e) {
        if (!isScratched) {
            ctx.clearRect(e.offsetX - 10, e.offsetY - 10, 20, 20);
            isScratched = true;

            setTimeout(() => {
                document.getElementById("scratch").style.display = "none";
                document.getElementById("gift").style.display = "block";
            }, 500);
        }
    }
    scratchCanvas.addEventListener("mousedown", scratch);
}

</script>
</body>
</html>